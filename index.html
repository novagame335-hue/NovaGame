<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NovaGame — Официальный Маркетплейс</title>
    
    <link rel="icon" type="image/png" href="Logo780.png">

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        /* --- БАЗОВЫЕ СТИЛИ --- */
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            background: radial-gradient(circle at center, #1a0101, #000000);
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- ШАПКА --- */
        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: rgba(0, 0, 0, 0.95);
            padding: 0 40px;
            height: 90px;
            border-bottom: 1px solid #1a1a1a;
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 1000;
            backdrop-filter: blur(15px);
        }

        .logo-img {
            height: 50px;
            filter: drop-shadow(0 0 10px rgba(255, 0, 0, 0.4));
        }

        .brand-name {
            font-size: 24px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: -1px;
        }

        .brand-name span { color: #ff0000; }

        /* --- ПОИСК --- */
        .search-wrapper {
            position: relative;
            width: 100%;
            max-width: 500px;
        }

        .search-input {
            width: 100%;
            background: #111;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 12px 20px 12px 45px;
            color: white;
            transition: 0.3s;
        }

        .search-input:focus {
            border-color: #ff0000;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.2);
            outline: none;
        }

        .search-dropdown {
            position: absolute;
            top: 110%;
            left: 0; right: 0;
            background: #0f0f0f;
            border: 1px solid #333;
            border-radius: 12px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            flex-direction: column;
            z-index: 10000;
        }

        /* --- КАРТОЧКИ --- */
        .game-card-item {
            background: #0d0d0d;
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid #1a1a1a;
            transition: transform 0.3s, border-color 0.3s;
            display: block;
            position: relative;
            aspect-ratio: 1/1;
        }

        .game-card-item:hover {
            transform: translateY(-5px);
            border-color: #ff0000;
        }

        .game-img-thumb {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.8;
        }

        .game-caption {
            position: absolute;
            bottom: 0; left: 0; right: 0;
            padding: 20px 10px 10px;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
        }

        /* --- АДМИНКА --- */
        #admin-panel {
            display: none;
            max-width: 1300px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .admin-btn {
            background: #ff0000;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            font-size: 13px;
            margin-right: 10px;
        }

        /* --- МОБИЛКА --- */
        @media (max-width: 850px) {
            header { padding: 0 15px; height: 70px; }
            .brand-name { display: none; }
            .header-right { display: none; }
            .mobile-nav { 
                display: flex; 
                position: fixed; bottom: 0; left: 0; right: 0;
                background: #050505; height: 65px; border-top: 1px solid #222;
                justify-content: space-around; align-items: center; z-index: 1000;
            }
        }
    </style>
</head>
<body>

    <header>
        <div class="header-left">
            <a href="index.html" style="text-decoration:none; color:inherit; display:flex; align-items:center; gap:10px;">
                <img src="Logo780.png" alt="NG" class="logo-img">
                <div class="brand-name">Nova<span>Game</span></div>
            </a>
        </div>

        <div class="header-center">
            <div class="search-wrapper">
                <input type="text" id="globalSearch" class="search-input" placeholder="Поиск игр...">
                <div id="search-results-dropdown" class="search-dropdown"></div>
            </div>
        </div>

        <div class="header-right" id="nav-desktop"></div>
    </header>

    <div style="height: 100px;"></div>

    <div id="admin-panel">
        <a href="add-game.html" class="admin-btn">＋ Категория</a>
        <a href="add-news.html" class="admin-btn" style="background:#222">＋ Баннер</a>
    </div>

    <section class="banners-section" style="max-width:1300px; margin: 0 auto; padding: 0 20px;">
        <h3 style="color:#ff0000; font-size: 14px; letter-spacing: 1px;">АКЦИИ И НОВОСТИ</h3>
        <div style="position:relative; display:flex; align-items:center;">
            <div class="banners-scroll-container" id="banners-list" style="display:flex; gap:15px; overflow-x:auto; scrollbar-width:none; padding: 10px 0;"></div>
        </div>
    </section>

    <main class="catalog-section" style="max-width:1300px; margin: 40px auto; padding: 0 20px 100px;">
        <h3 style="margin-bottom:20px;">КАТАЛОГ</h3>
        <div class="catalog-grid" id="catalog-list" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap:20px;"></div>
    </main>

    <nav class="mobile-nav" id="nav-mobile" style="display:none;"></nav>

    <script>
        // ЗАМЕНИТЕ ЭТИ ДАННЫЕ НА ВАШИ ИЗ КОНСОЛИ FIREBASE
        const firebaseConfig = {
            apiKey: "ВАШ_API_KEY", 
            authDomain: "novagame-b15b6.firebaseapp.com",
            databaseURL: "https://novagame-b15b6-default-rtdb.europe-west1.firebasedatabase.app/",
            projectId: "novagame-b15b6",
            storageBucket: "novagame-b15b6.firebasestorage.app",
            messagingSenderId: "7572791951",
            appId: "1:7572791951:web:7c207e63da98fd9c28c6fa"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        // Загрузка баннеров
        function loadBanners() {
            db.ref('news').on('value', (snapshot) => {
                const container = document.getElementById('banners-list');
                let html = '';
                snapshot.forEach(child => {
                    const data = child.val();
                    html += `
                        <div style="min-width:300px; height:160px; border-radius:15px; overflow:hidden; border:1px solid #222;">
                            <a href="${data.link || '#'}"><img src="${data.image}" style="width:100%; height:100%; object-fit:cover;"></a>
                        </div>`;
                });
                container.innerHTML = html;
            });
        }

        // Загрузка каталога
        function loadCatalog() {
            db.ref('games').on('value', (snapshot) => {
                const list = document.getElementById('catalog-list');
                let html = '';
                snapshot.forEach(child => {
                    const game = child.val();
                    const id = child.key;
                    const tags = (game.name + " " + (game.keywords || "")).toLowerCase();
                    html += `
                        <div class="game-card-wrapper" data-tags="${tags}">
                            <a href="category.html?id=${id}" class="game-card-item">
                                <img src="${game.image}" class="game-img-thumb" loading="lazy">
                                <div class="game-caption"><div style="font-size:13px; font-weight:bold;">${game.name}</div></div>
                            </a>
                        </div>`;
                });
                list.innerHTML = html;
            });
        }

        // Поиск
        const searchInput = document.getElementById('globalSearch');
        const searchDropdown = document.getElementById('search-results-dropdown');

        searchInput.addEventListener('input', function() {
            const val = this.value.toLowerCase().trim();
            
            // Фильтрация плитки на странице
            document.querySelectorAll('.game-card-wrapper').forEach(card => {
                card.style.display = card.dataset.tags.includes(val) ? 'block' : 'none';
            });

            // Выпадающий список
            if (val.length < 1) {
                searchDropdown.style.display = 'none';
                return;
            }

            db.ref('games').once('value', (snapshot) => {
                let html = '';
                snapshot.forEach(child => {
                    const game = child.val();
                    if (game.name.toLowerCase().includes(val)) {
                        html += `
                            <a href="category.html?id=${child.key}" style="display:flex; align-items:center; gap:10px; padding:10px; border-bottom:1px solid #222; text-decoration:none; color:white;">
                                <img src="${game.image}" style="width:30px; height:30px; border-radius:5px; object-fit:cover;">
                                <span style="font-size:14px;">${game.name}</span>
                            </a>`;
                    }
                });
                searchDropdown.innerHTML = html || '<div style="padding:10px; color:#666;">Ничего не найдено</div>';
                searchDropdown.style.display = 'flex';
            });
        });

        // Скрыть поиск при клике вне
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.search-wrapper')) searchDropdown.style.display = 'none';
        });

        // Авторизация
        auth.onAuthStateChanged((user) => {
            const dNav = document.getElementById('nav-desktop');
            const mNav = document.getElementById('nav-mobile');
            const aPanel = document.getElementById('admin-panel');

            if (user) {
                db.ref('users/' + user.uid).on('value', (snap) => {
                    const profile = snap.val() || {};
                    if(aPanel) aPanel.style.display = profile.admin ? 'block' : 'none';
                    
                    const menu = `
                        <a href="chat.html" style="text-decoration:none; color:red; font-weight:bold; font-size:12px;">ЧАТ</a>
                        <a href="profile.html" style="text-decoration:none; color:white; display:flex; align-items:center; gap:8px;">
                            <img src="${profile.profilePic || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'}" style="width:30px; height:30px; border-radius:50%; border:1px solid red;">
                        </a>`;
                    dNav.innerHTML = menu;
                    mNav.innerHTML = menu;
                    mNav.style.display = 'flex';
                });
            } else {
                const loginBtn = `<a href="login.html" style="color:red; text-decoration:none; font-weight:800; border:1px solid red; padding:5px 15px; border-radius:8px;">ВХОД</a>`;
                dNav.innerHTML = loginBtn;
                mNav.innerHTML = loginBtn;
                mNav.style.display = 'flex';
            }
        });

        loadBanners();
        loadCatalog();
    </script>
</body>
</html>
