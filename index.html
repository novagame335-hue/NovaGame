<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NovaGame — Маркетплейс</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root {
            --nova-red: #ff1e26;
            --header-bg: rgba(5, 5, 5, 0.85);
            --modal-bg: rgba(10, 10, 10, 0.98);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        /* МЕДЛЕННЫЙ ФОН (30 секунд) */
        body, html { 
            height: 100%; width: 100%;
            font-family: 'Segoe UI', sans-serif; 
            color: white; 
            overflow: hidden;
            background: linear-gradient(135deg, #050505, #1a0202, #3d0505, #050505);
            background-size: 400% 400%;
            animation: liquidFlow 30s ease infinite;
        }

        @keyframes liquidFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        header {
            width: 100%; height: 75px; display: flex; align-items: center; justify-content: space-between;
            padding: 0 40px; background: var(--header-bg); backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(255, 30, 38, 0.2); position: fixed; top: 0; z-index: 1000;
        }

        .brand-zone { display: flex; align-items: center; gap: 12px; }
        .ng-logo {
            background: #1a1a1a; border: 1px solid #333; border-radius: 8px;
            width: 42px; height: 42px; display: flex; align-items: center; justify-content: center;
            font-size: 22px; font-weight: 900; color: var(--nova-red);
        }
        .brand-text { font-size: 24px; font-weight: 700; }
        .brand-text .nova { color: var(--nova-red); }

        .search-zone { flex: 1; display: flex; justify-content: center; padding: 0 50px; }
        .search-input {
            width: 100%; max-width: 500px; height: 42px; background: rgba(17, 17, 17, 0.6); border: 1px solid #333;
            border-radius: 10px; padding: 0 20px; color: white; outline: none;
        }

        .nav-zone { display: flex; align-items: center; gap: 20px; }
        .chat-link { display: flex; flex-direction: column; align-items: center; cursor: pointer; text-decoration: none; }
        .chat-icon { width: 22px; height: 22px; fill: #fff; }
        .chat-label { font-size: 11px; color: #fff; font-weight: 600; }

        .auth-btn {
            height: 42px; padding: 0 25px; background: transparent; border: 1px solid var(--nova-red);
            border-radius: 8px; color: white; font-weight: 800; cursor: pointer; transition: 0.3s;
        }
        .auth-btn:hover { background: var(--nova-red); }

        /* МОДАЛЬНЫЕ ОКНА */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(8px);
            display: none; justify-content: center; align-items: center; z-index: 2000;
        }

        .modal-content {
            background: var(--modal-bg); width: 90%; max-width: 450px;
            padding: 40px 30px; border-radius: 24px; border: 1px solid rgba(255, 30, 38, 0.3);
            display: flex; flex-direction: column; position: relative; text-align: center;
        }

        .terms-title { color: var(--nova-red); font-size: 22px; margin-bottom: 15px; }
        .terms-body { overflow-y: auto; padding-right: 15px; margin-bottom: 20px; color: #ccc; font-size: 14px; text-align: left; max-height: 300px; }
        .terms-body h3 { color: #fff; margin-top: 15px; }

        .back-btn { background: #1a1a1a; color: white; border: 1px solid #333; padding: 14px; border-radius: 12px; cursor: pointer; width: 100%; font-weight: 800; margin-top: 10px; }

        .agreement-box { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 25px; font-size: 14px; color: #aaa; }
        
        .google-login-btn {
            display: flex; align-items: center; justify-content: center; gap: 12px;
            width: 100%; padding: 16px; background: white; color: black;
            border-radius: 14px; font-weight: 700; cursor: pointer; border: none;
            opacity: 0.3; pointer-events: none; transition: 0.3s;
        }
        .google-login-btn.active { opacity: 1; pointer-events: all; }
        .google-login-btn:hover { background: #f1f1f1; transform: translateY(-2px); }

        .user-avatar { width: 80px; height: 80px; border-radius: 50%; border: 2px solid var(--nova-red); margin: 0 auto 15px; }
        .close-modal { position: absolute; top: 20px; right: 20px; color: #555; cursor: pointer; font-size: 28px; line-height: 1; }
    </style>
</head>
<body>

    <header>
        <div class="brand-zone">
            <div class="ng-logo">N<span style="color:white">G</span></div>
            <div class="brand-text"><span class="nova">Nova</span>Game</div>
        </div>
        <div class="search-zone">
            <input type="text" class="search-input" placeholder="Поиск игр и товаров...">
        </div>
        <div class="nav-zone">
            <div class="chat-link">
                <svg class="chat-icon" viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
                <span class="chat-label">чат</span>
            </div>
            <button class="auth-btn" id="headerAuthBtn" onclick="openModal('authModal')">ВОЙТИ</button>
        </div>
    </header>

    <div class="modal-overlay" id="authModal">
        <div class="modal-content" id="modalMainContent">
            <span class="close-modal" onclick="closeModal('authModal')">&times;</span>
            <h2 id="modalTitle" style="margin-bottom:25px; font-size: 28px;">Вход в систему</h2>
            
            <div id="loginForm">
                <div class="agreement-box">
                    <input type="checkbox" id="termsCheckbox" onchange="toggleGoogleBtn()">
                    <span>Я принимаю <span style="text-decoration:underline; cursor:pointer; color: white;" onclick="switchModal('authModal', 'termsModal')">правила сервиса</span></span>
                </div>
                <button id="googleBtn" class="google-login-btn" onclick="startGoogleLogin()">
                    <img src="https://www.gstatic.com/images/branding/product/1x/gsa_512dp.png" width="20">
                    Войти через Google
                </button>
            </div>

            <div id="userInfo" style="display:none;">
                <img id="userImg" class="user-avatar" src="">
                <h3 id="userWelcome" style="margin-bottom:10px;"></h3>
                <p style="color: #888; margin-bottom: 25px;">Добро пожаловать в NovaGame!</p>
                <button class="back-btn" onclick="logout()">ВЫЙТИ ИЗ АККАУНТА</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="termsModal">
        <div class="modal-content">
            <h2 class="terms-title">Условия соглашения</h2>
            <div class="terms-body">
                <h3>1. Общие положения</h3>
                <p>NovaGame — это площадка для обмена игровыми ценностями. Мы обеспечиваем безопасность сделок через систему холдирования средств.</p>
                <h3>2. Безопасность</h3>
                <p>Все операции проходят проверку. Не передавайте данные аккаунта в чате третьим лицам.</p>
                <h3>3. Конфиденциальность</h3>
                <p>Авторизуясь через Google, вы передаете нам только публичное имя и email для идентификации вашего профиля.</p>
            </div>
            <button class="back-btn" onclick="switchModal('termsModal', 'authModal')">НАЗАД</button>
        </div>
    </div>

    <script>
        // ИНИЦИАЛИЗАЦИЯ ТВОИМ КЛЮЧОМ
        window.onload = function () {
            google.accounts.id.initialize({
                client_id: "515694413272-eeab1le8pkg26nlbtg03hph4fmcfo6eu.apps.googleusercontent.com",
                callback: handleCredentialResponse
            });
        }

        function startGoogleLogin() {
            google.accounts.id.prompt(); // Показать окно выбора аккаунта
        }

        function handleCredentialResponse(response) {
            // Расшифровка данных пользователя из JWT токена
            const responsePayload = parseJwt(response.credential);
            
            // Обновляем UI в шапке
            document.getElementById('headerAuthBtn').innerText = responsePayload.given_name.toUpperCase();
            
            // Обновляем форму в модалке
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('userInfo').style.display = 'block';
            document.getElementById('modalTitle').innerText = "Успешный вход";
            document.getElementById('userImg').src = responsePayload.picture;
            document.getElementById('userWelcome').innerText = responsePayload.name;

            console.log("ID: " + responsePayload.sub);
            console.log('Full Name: ' + responsePayload.name);
        }

        // Вспомогательная функция для чтения данных Google
        function parseJwt (token) {
            var base64Url = token.split('.')[1];
            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        };

        function logout() {
            location.reload(); // Для прототипа просто перезагрузим страницу
        }

        // Логика интерфейса
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function switchModal(c, o) { closeModal(c); openModal(o); }
        
        function toggleGoogleBtn() {
            const cb = document.getElementById('termsCheckbox');
            const btn = document.getElementById('googleBtn');
            cb.checked ? btn.classList.add('active') : btn.classList.remove('active');
        }

        window.onclick = function(e) { if (e.target.classList.contains('modal-overlay')) e.target.style.display = 'none'; }
    </script>
</body>
</html>