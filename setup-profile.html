<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Настройка профиля — NovaGame</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        body {
            margin: 0;
            background: radial-gradient(circle at center, #350101, #000000, #220101, #000000);
            background-size: 300% 300%;
            animation: smoothBG 20s ease-in-out infinite;
            font-family: 'Segoe UI', sans-serif;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        @keyframes smoothBG {
            0% { background-position: 0% 0%; }
            50% { background-position: 100% 100%; }
            100% { background-position: 0% 0%; }
        }

        .setup-card {
            background: rgba(0, 0, 0, 0.9);
            padding: 40px;
            border-radius: 20px;
            border: 1px solid #ff0000;
            text-align: center;
            width: 380px;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.3);
        }

        .avatar-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 2px solid #ff0000;
            margin-bottom: 20px;
            object-fit: cover;
        }

        input {
            width: 100%;
            padding: 12px;
            margin: 20px 0;
            background: #111;
            border: 1px solid #333;
            border-radius: 8px;
            color: white;
            box-sizing: border-box;
            outline: none;
        }

        input:focus { border-color: #ff0000; }

        .btn-save {
            width: 100%;
            padding: 14px;
            background: #ff0000;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn-save:hover { background: #cc0000; }
    </style>
</head>
<body>

<div class="setup-card">
    <img id="pre-pic" src="default-avatar.png" class="avatar-preview">
    <h2>Придумайте никнейм</h2>
    <p style="font-size: 14px; color: #888;">Это имя будут видеть другие игроки</p>
    
    <input type="text" id="username-input" placeholder="Ваш ник..." maxlength="15">
    
    <button class="btn-save" onclick="saveProfile()">СОХРАНИТЬ И ВОЙТИ</button>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBmVusnUmwqWTMRSUeL4uTF_yrXQvZA0eQ",
        authDomain: "novagame-b15b6.firebaseapp.com",
        databaseURL: "https://novagame-b15b6-default-rtdb.europe-west1.firebasedatabase.app/",
        projectId: "novagame-b15b6",
        storageBucket: "novagame-b15b6.firebasestorage.app",
        messagingSenderId: "7572791951",
        appId: "1:7572791951:web:7c207e63da98fd9c28c6fa"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // Загружаем аватарку из Google сразу для превью
    auth.onAuthStateChanged((user) => {
        if (user) {
            document.getElementById('pre-pic').src = user.photoURL || 'default-avatar.png';
        } else {
            // Если чудом зашли сюда без логина — уходим
            window.location.href = "login.html";
        }
    });

    function saveProfile() {
        const user = auth.currentUser;
        const name = document.getElementById('username-input').value.trim();

        if (name.length < 3) {
            alert("Никнейм слишком короткий!");
            return;
        }

        if (user) {
            // Создаем запись в Realtime Database
            db.ref('users/' + user.uid).set({
                username: name,
                profilePic: user.photoURL,
                balance: 0,
                email: user.email,
                uid: user.uid
            }).then(() => {
                // После сохранения отправляем на главную
                window.location.href = "index.html";
            }).catch((error) => {
                alert("Ошибка сохранения: " + error.message);
            });
        }
    }
</script>

</body>
</html>
